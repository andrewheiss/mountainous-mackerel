{
  "hash": "bc02848fb1c9bd15ae731647194e07e5",
  "result": {
    "markdown": "---\ntitle: \"H<sub>2</sub>: Civil society and human rights\"\nformat:\n  html:\n    code-fold: true\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(targets)\nlibrary(broom)\nlibrary(modelsummary)\nlibrary(kableExtra)\nlibrary(ordinal)\nlibrary(brms)\nlibrary(marginaleffects)\nlibrary(tidybayes)\nlibrary(ggdist)\nlibrary(bayesplot)\nlibrary(patchwork)\nlibrary(scales)\n\n# Bayes stuff\nBAYES_SEED <- 1234\noptions(mc.cores = 4,\n        brms.backend = \"cmdstanr\")\n\n# Generated via random.org\nset.seed(2385)\n\n# Load targets\nwithr::with_dir(here::here(), {\n  # Final data\n  tar_load(daily_panel)\n  tar_load(weekly_panel)\n  tar_load(year_week_lookup)\n  \n  # Models\n  tar_load(m_h2)\n  tar_load(m_coef_gof)\n  \n  # Plotting functions\n  invisible(list2env(tar_read(graphic_functions), .GlobalEnv))\n})\n\n# Tell bayesplot to use the Lakota palette for things like pp_check()\nbayesplot::color_scheme_set(clrs[c(1, 2, 4, 5, 7, 8)])\n\nweekly_panel <- weekly_panel %>% \n  mutate(across(c(new_cases, new_deaths, cumulative_cases, cumulative_deaths),\n                list(z = ~as.numeric(scale(.)))))\n```\n:::\n\n\n\n# Model and priors\n\n## Official formal model\n\n$$\n\\begin{aligned}\n\\text{COVID policy}_{i, t} \\sim&\\ \\operatorname{Bernoulli}(\\pi_{i, t}) \\\\\n\\operatorname{logit}(\\pi_{i, t}) =&\\ \\alpha_{\\text{region} [i]} + \\\\\n&\\ \\beta_1\\ \\text{Derogation in effect}_{i}\\ + \\beta_2\\ \\text{Civil society repression}_{i}\\ +\\\\\n&\\ \\beta_3\\ {(\\text{Derogation} \\times \\text{Civil society repression})}_{i}\\ + \\\\\n&\\ \\beta_4\\ \\text{New cases}_{i}\\ + \\beta_5\\ \\text{Cumulative cases}_{i}\\ + \\\\\n&\\ \\beta_6\\ \\text{New deaths}_{i}\\ + \\beta_7\\ \\text{Cumulative deaths}_{i}\\ + \\\\\n&\\ \\beta_8\\ \\text{Past ICCPR derogation}_{i}\\ + \\beta_9\\ \\text{Past ICCPR action}_{i}\\ + \\\\\n&\\ \\beta_{10}\\ \\text{Rule of law index}_{i}\\ + \\beta_{11}\\ \\text{Civil liberties index}_{i}\\ + \\\\\n&\\ \\beta_{12}\\ \\text{Week number}_{i} \\\\\n\\alpha_j \\sim&\\ \\mathcal{N}(\\bar{\\alpha}, \\sigma_\\alpha) \\text{, for } j \\text{ in } 1 \\dots J \\\\\n\\\\\n\\bar{\\alpha} \\sim&\\ \\operatorname{Student t}(\\nu = 1, \\mu = 0, \\sigma = 3) \\\\\n\\beta_{1 \\dots 12} \\sim&\\ \\operatorname{Student t}(\\nu = 1, \\mu = 0, \\sigma = 3) \\\\\n\\sigma_a \\sim&\\ \\operatorname{Cauchy}(x = 0, \\gamma = 1) \\text{, lower bound} = 0\n\\end{aligned}\n$$\n\n## Priors\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- ggplot() +\n  stat_function(geom = \"area\", \n                fun = ~extraDistr::dlst(., df = 1, mu = 0, sigma = 3), \n                fill = clrs[2]) +\n  xlim(c(-20, 20)) +\n  annotate(geom = \"label\", x = 0, y = 0.02, label = \"Student t(1, 0, 3)\") +\n  labs(x = \"α and βs\") +\n  theme_pandem(prior = TRUE)\n## Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.\n## ℹ Please use the `linewidth` argument instead.\n## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\n## ℹ Please use the `linewidth` argument instead.\n\np2 <- ggplot() +\n  stat_function(geom = \"area\", \n                fun = ~dcauchy(., 0, 1), \n                fill = clrs[4]) +\n  xlim(c(0, 10)) +\n  annotate(geom = \"label\", x = 5, y = 0.063, label = \"Cauchy(0, 1)\") +\n  labs(x = \"σ\") +\n  theme_pandem(prior = TRUE)\n\np1 | p2\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n## Prior simulation\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"show\"}\nologit_priors <- c(prior(student_t(1, 0, 3), class = Intercept),\n                   prior(student_t(1, 0, 3), class = b),\n                   prior(cauchy(0, 1), class = sd, lb = 0))\n\nmodel_h2_prior_only <- brm(\n  bf(pandem_abusive ~ derogation_ineffect*v2csreprss + \n       new_cases_z + cumulative_cases_z + \n       new_deaths_z + cumulative_deaths_z + \n       prior_iccpr_derogations + prior_iccpr_other_action +\n       v2x_rule + v2x_civlib +\n       year_week_num + (1 | who_region)), \n  data = weekly_panel,\n  family = \"cumulative\",\n  prior = ologit_priors,\n  sample_prior = \"only\",\n  chains = 4, seed = BAYES_SEED, iter = 5000, refresh = 0,\n  threads = threading(2)  # Two CPUs per chain to speed things up\n)\n## Start sampling\n## Running MCMC with 4 parallel chains, with 2 thread(s) per chain...\n## \n## Chain 3 finished in 2.7 seconds.\n## Chain 2 finished in 3.0 seconds.\n## Chain 4 finished in 3.0 seconds.\n## Chain 1 finished in 4.6 seconds.\n## \n## All 4 chains finished successfully.\n## Mean chain execution time: 3.3 seconds.\n## Total execution time: 4.7 seconds.\n## Warning: 164 of 10000 (2.0%) transitions hit the maximum treedepth limit of 10.\n## See https://mc-stan.org/misc/warnings for details.\nmodel_h2_prior_only\n##  Family: cumulative \n##   Links: mu = logit; disc = identity \n## Formula: pandem_abusive ~ derogation_ineffect * v2csreprss + new_cases_z + cumulative_cases_z + new_deaths_z + cumulative_deaths_z + prior_iccpr_derogations + prior_iccpr_other_action + v2x_rule + v2x_civlib + year_week_num + (1 | who_region) \n##    Data: weekly_panel (Number of observations: 9591) \n##   Draws: 4 chains, each with iter = 5000; warmup = 2500; thin = 1;\n##          total post-warmup draws = 10000\n## \n## Group-Level Effects: \n## ~who_region (Number of levels: 6) \n##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\n## sd(Intercept)     5.74     71.04     0.04    27.08 1.00     7280     3658\n## \n## Population-Level Effects: \n##                                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\n## Intercept[1]                   -1389.09  12211.83 -5055.90  1652.15 1.02      458      187\n## Intercept[2]                   -1374.64  12212.63 -5053.57  1655.87 1.02      565      188\n## Intercept[3]                   -1352.43  12219.02 -5052.53  1761.78 1.02      576      187\n## derogation_ineffect               -0.25     28.80   -36.87    30.66 1.00     4138     1243\n## v2csreprss                         1.12     49.72   -37.06    40.53 1.00     4908     1310\n## new_cases_z                        0.24     40.83   -37.11    36.49 1.00     2674     1006\n## cumulative_cases_z                 2.02     50.15   -36.53    43.48 1.01     1822      633\n## new_deaths_z                       1.15     51.98   -34.62    33.06 1.01     3306     1275\n## cumulative_deaths_z                6.50    111.45   -41.82    47.74 1.01     1229      516\n## prior_iccpr_derogationsTRUE       -0.19     20.53   -30.13    27.88 1.00     5438     1546\n## prior_iccpr_other_actionTRUE       0.83     29.07   -35.73    35.71 1.01     6657     1357\n## v2x_rule                          -1.48     28.05   -42.66    31.32 1.01     3291     1140\n## v2x_civlib                        -5.61     82.92   -52.38    42.70 1.02      347      157\n## year_week_num                    -38.88    348.96  -144.44    47.40 1.02      776      189\n## derogation_ineffect:v2csreprss  -134.06    713.43 -2930.53    33.62 1.04      144       31\n## \n## Family Specific Parameters: \n##      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\n## disc     1.00      0.00     1.00     1.00   NA       NA       NA\n## \n## Draws were sampled using sample(hmc). For each parameter, Bulk_ESS\n## and Tail_ESS are effective sample size measures, and Rhat is the potential\n## scale reduction factor on split chains (at convergence, Rhat = 1).\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndatagrid(model = model_h2_prior_only,\n         year_week_num = 1:69,\n         derogation_ineffect = 0:1) %>% \n  add_epred_draws(model_h2_prior_only, ndraws = 100) %>% \n  left_join(year_week_lookup, by = \"year_week_num\") %>% \n  mutate(derogation_ineffect = factor(derogation_ineffect, \n                                      levels = 0:1,\n                                      labels = c(\"No\", \"Yes\"),\n                                      ordered = TRUE)) %>% \n  ggplot(aes(x = year_week_day, y = .epred, color = .category)) +\n  geom_line(aes(group = paste(.draw, .category, derogation_ineffect)), alpha = 0.5, linewidth = 0.5) +\n  scale_color_manual(values = c(clrs[c(2, 4, 6, 7)])) +\n  scale_x_date(date_breaks = \"2 months\", date_labels = \"%b\\n%Y\") +\n  scale_y_continuous(labels = label_percent()) +\n  labs(x = NULL, y = \"Predicted probability\", \n       color = \"Severity\",\n       title = \"Abusive enforcement (priors only)\") +\n  theme_pandem()\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n\n# Posterior\n\n\n::: {#tbl-h2 .cell layout-align=\"center\" hash='analysis_h2_cache/html/tbl-h2_56ad4c7ed4b9cf2055456d6c066374a1'}\n\n```{.r .cell-code}\nmodelsummary(pull(m_h2, model, name = nice),\n             estimate = \"{estimate}\",\n             statistic = \"conf.int\",\n             fmt = 2, coef_map = m_coef_gof$coef_map, \n             gof_map = m_coef_gof$gof_map,\n             metrics = c(\"none\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> Discriminatory Policy </th>\n   <th style=\"text-align:center;\"> Non-Derogable Rights </th>\n   <th style=\"text-align:center;\"> Limiting Media </th>\n   <th style=\"text-align:center;\"> Abusive Enforcement </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Derogation in effect </td>\n   <td style=\"text-align:center;\"> −1.92 </td>\n   <td style=\"text-align:center;\"> −0.12 </td>\n   <td style=\"text-align:center;\"> −0.13 </td>\n   <td style=\"text-align:center;\"> −0.02 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−3.04, −1.03] </td>\n   <td style=\"text-align:center;\"> [−0.84, 0.55] </td>\n   <td style=\"text-align:center;\"> [−0.58, 0.31] </td>\n   <td style=\"text-align:center;\"> [−0.35, 0.29] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Civil society repression </td>\n   <td style=\"text-align:center;\"> −0.43 </td>\n   <td style=\"text-align:center;\"> 0.14 </td>\n   <td style=\"text-align:center;\"> −0.61 </td>\n   <td style=\"text-align:center;\"> −0.68 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.53, −0.33] </td>\n   <td style=\"text-align:center;\"> [−0.01, 0.29] </td>\n   <td style=\"text-align:center;\"> [−0.70, −0.52] </td>\n   <td style=\"text-align:center;\"> [−0.77, −0.60] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Derogation × Civil society represstion </td>\n   <td style=\"text-align:center;\"> 0.92 </td>\n   <td style=\"text-align:center;\"> −0.14 </td>\n   <td style=\"text-align:center;\"> −0.07 </td>\n   <td style=\"text-align:center;\"> 0.20 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.54, 1.36] </td>\n   <td style=\"text-align:center;\"> [−0.61, 0.29] </td>\n   <td style=\"text-align:center;\"> [−0.31, 0.18] </td>\n   <td style=\"text-align:center;\"> [0.008, 0.39] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> New cases (standardized) </td>\n   <td style=\"text-align:center;\"> 0.04 </td>\n   <td style=\"text-align:center;\"> −0.007 </td>\n   <td style=\"text-align:center;\"> 0.16 </td>\n   <td style=\"text-align:center;\"> 0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.04, 0.13] </td>\n   <td style=\"text-align:center;\"> [−0.31, 0.24] </td>\n   <td style=\"text-align:center;\"> [0.07, 0.26] </td>\n   <td style=\"text-align:center;\"> [−0.08, 0.08] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cumulative cases (standardized) </td>\n   <td style=\"text-align:center;\"> 0.01 </td>\n   <td style=\"text-align:center;\"> 0.17 </td>\n   <td style=\"text-align:center;\"> −0.13 </td>\n   <td style=\"text-align:center;\"> 0.16 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.16, 0.19] </td>\n   <td style=\"text-align:center;\"> [−0.26, 0.55] </td>\n   <td style=\"text-align:center;\"> [−0.27, 0.0009] </td>\n   <td style=\"text-align:center;\"> [0.04, 0.28] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> New deaths (standardized) </td>\n   <td style=\"text-align:center;\"> −0.06 </td>\n   <td style=\"text-align:center;\"> −0.11 </td>\n   <td style=\"text-align:center;\"> −0.03 </td>\n   <td style=\"text-align:center;\"> 0.09 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.18, 0.06] </td>\n   <td style=\"text-align:center;\"> [−0.38, 0.11] </td>\n   <td style=\"text-align:center;\"> [−0.12, 0.06] </td>\n   <td style=\"text-align:center;\"> [0.006, 0.18] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cumulative deaths (standardized) </td>\n   <td style=\"text-align:center;\"> 0.10 </td>\n   <td style=\"text-align:center;\"> −0.36 </td>\n   <td style=\"text-align:center;\"> 0.22 </td>\n   <td style=\"text-align:center;\"> −0.13 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.11, 0.29] </td>\n   <td style=\"text-align:center;\"> [−0.76, −0.02] </td>\n   <td style=\"text-align:center;\"> [0.10, 0.34] </td>\n   <td style=\"text-align:center;\"> [−0.26, −0.003] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Past ICCPR derogation </td>\n   <td style=\"text-align:center;\"> 0.82 </td>\n   <td style=\"text-align:center;\"> 0.27 </td>\n   <td style=\"text-align:center;\"> 0.08 </td>\n   <td style=\"text-align:center;\"> 0.23 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.66, 0.99] </td>\n   <td style=\"text-align:center;\"> [0.03, 0.50] </td>\n   <td style=\"text-align:center;\"> [−0.06, 0.22] </td>\n   <td style=\"text-align:center;\"> [0.11, 0.35] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Past ICCPR action </td>\n   <td style=\"text-align:center;\"> 0.26 </td>\n   <td style=\"text-align:center;\"> 1.50 </td>\n   <td style=\"text-align:center;\"> 0.13 </td>\n   <td style=\"text-align:center;\"> −0.002 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.10, 0.41] </td>\n   <td style=\"text-align:center;\"> [1.31, 1.69] </td>\n   <td style=\"text-align:center;\"> [−0.01, 0.27] </td>\n   <td style=\"text-align:center;\"> [−0.12, 0.11] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Year-week </td>\n   <td style=\"text-align:center;\"> −0.01 </td>\n   <td style=\"text-align:center;\"> −0.01 </td>\n   <td style=\"text-align:center;\"> −0.02 </td>\n   <td style=\"text-align:center;\"> −0.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.02, −0.01] </td>\n   <td style=\"text-align:center;\"> [−0.01, −0.005] </td>\n   <td style=\"text-align:center;\"> [−0.02, −0.02] </td>\n   <td style=\"text-align:center;\"> [−0.03, −0.03] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Rule of law </td>\n   <td style=\"text-align:center;\"> 1.54 </td>\n   <td style=\"text-align:center;\"> 0.98 </td>\n   <td style=\"text-align:center;\"> −1.87 </td>\n   <td style=\"text-align:center;\"> −0.04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [1.11, 1.97] </td>\n   <td style=\"text-align:center;\"> [0.43, 1.52] </td>\n   <td style=\"text-align:center;\"> [−2.21, −1.53] </td>\n   <td style=\"text-align:center;\"> [−0.31, 0.24] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Civil liberties </td>\n   <td style=\"text-align:center;\"> 0.47 </td>\n   <td style=\"text-align:center;\"> −4.18 </td>\n   <td style=\"text-align:center;\"> −4.82 </td>\n   <td style=\"text-align:center;\"> 2.62 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [−0.28, 1.20] </td>\n   <td style=\"text-align:center;\"> [−5.15, −3.25] </td>\n   <td style=\"text-align:center;\"> [−5.66, −4.00] </td>\n   <td style=\"text-align:center;\"> [2.11, 3.12] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Constant </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −0.90 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> [−1.89, 0.11] </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cut 1 </td>\n   <td style=\"text-align:center;\"> 2.30 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −7.03 </td>\n   <td style=\"text-align:center;\"> 1.27 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.75, 3.40] </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> [−7.90, −6.03] </td>\n   <td style=\"text-align:center;\"> [0.61, 1.86] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cut 2 </td>\n   <td style=\"text-align:center;\"> 3.05 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −6.64 </td>\n   <td style=\"text-align:center;\"> 2.30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [1.50, 4.13] </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> [−7.51, −5.65] </td>\n   <td style=\"text-align:center;\"> [1.64, 2.89] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cut 3 </td>\n   <td style=\"text-align:center;\"> 3.24 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −6.31 </td>\n   <td style=\"text-align:center;\"> 3.73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [1.68, 4.33] </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> [−7.17, −5.32] </td>\n   <td style=\"text-align:center;\"> [3.05, 4.33] </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Region random effects σ </td>\n   <td style=\"text-align:center;\"> 1.34 </td>\n   <td style=\"text-align:center;\"> 0.95 </td>\n   <td style=\"text-align:center;\"> 0.80 </td>\n   <td style=\"text-align:center;\"> 0.59 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> [0.77, 2.87] </td>\n   <td style=\"text-align:center;\"> [0.55, 2.11] </td>\n   <td style=\"text-align:center;\"> [0.47, 1.77] </td>\n   <td style=\"text-align:center;\"> [0.34, 1.29] </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n# Model evaluation\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trace <- function(model) {\n  model %>% \n    gather_draws(b_derogation_ineffect, b_year_week_num, b_v2csreprss, sd_who_region__Intercept) %>% \n    ggplot(aes(x = .iteration, y = .value, color = factor(.chain))) +\n    geom_line(linewidth = 0.1) +\n    scale_color_viridis_d(option = \"rocket\", end = 0.85) +\n    labs(color = \"Chain\") +\n    facet_wrap(vars(.variable), scales = \"free_y\") +\n    theme_pandem()\n}\n\nprelim_trank <- function(model) {\n  model %>% \n    gather_draws(b_derogation_ineffect, b_year_week_num, b_v2csreprss, sd_who_region__Intercept) %>% \n    group_by(.variable) %>% \n    mutate(draw_rank = rank(.value)) %>% \n    ggplot(aes(x = draw_rank, color = factor(.chain))) +\n    stat_bin(geom = \"step\", binwidth = 200, position = position_identity(), boundary = 0) +\n    scale_color_viridis_d(option = \"rocket\", end = 0.85) +\n    labs(color = \"Chain\") +\n    facet_wrap(vars(.variable), scales = \"free_y\") +\n    theme_pandem()\n}\n\nprelim_pp <- function(model) {\n  pp_check(model, ndraws = 100, type = \"bars\")\n}\n```\n:::\n\n\n::: {.panel-tabset}\n\n### Discriminatory Policy\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trace(m_h2$model[[1]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trank(m_h2$model[[1]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_pp(m_h2$model[[1]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n### Non-Derogable Rights\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trace(m_h2$model[[2]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trank(m_h2$model[[2]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_pp(m_h2$model[[2]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n### Limiting Media\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trace(m_h2$model[[3]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trank(m_h2$model[[3]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_pp(m_h2$model[[3]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n### Abusive Enforcement\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trace(m_h2$model[[4]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-14-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_trank(m_h2$model[[4]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=80%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprelim_pp(m_h2$model[[4]])\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=80%}\n:::\n:::\n\n\n:::\n\n\n# Interpretation and marginal effects\n\n## Predictions\n\n### Across time\n\n::: {.column-page-right}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nh2_models_plots <- m_h2 %>% \n  mutate(pred_plot = pmap(list(model, nice, family), ~{\n    if (..3 == \"cumulative\") {\n      datagrid(model = ..1,\n               year_week_num = 1:69,\n               derogation_ineffect = 0:1) %>% \n        add_epred_draws(..1) %>% \n        left_join(year_week_lookup, by = \"year_week_num\") %>% \n        mutate(derogation_ineffect = factor(derogation_ineffect, \n                                            levels = 0:1,\n                                            labels = c(\"No derogation\", \"Derogation in effect\"),\n                                            ordered = TRUE)) %>% \n        ggplot(aes(x = year_week_day, y = .epred, color = .category)) +\n        stat_lineribbon(aes(fill = .category), alpha = 0.3) +\n        scale_color_manual(values = c(clrs[c(2, 4, 6, 7)])) +\n        scale_fill_manual(values = c(clrs[c(2, 4, 6, 7)])) +\n        scale_x_date(date_breaks = \"2 months\", date_labels = \"%b\\n%Y\") +\n        scale_y_continuous(labels = label_percent()) +\n        labs(x = NULL, y = \"Predicted probability\", \n             color = \"Severity\", fill = \"Severity\",\n             title = ..2) +\n        facet_wrap(vars(derogation_ineffect)) +\n        theme_pandem()\n    } else {\n      datagrid(model = ..1,\n               year_week_num = 1:69,\n               derogation_ineffect = 0:1) %>% \n        add_epred_draws(..1) %>% \n        left_join(year_week_lookup, by = \"year_week_num\") %>% \n        mutate(derogation_ineffect = factor(derogation_ineffect, \n                                            levels = 0:1,\n                                            labels = c(\"No\", \"Yes\"),\n                                            ordered = TRUE)) %>% \n        ggplot(aes(x = year_week_day, y = .epred, color = derogation_ineffect)) +\n        stat_lineribbon(aes(fill = derogation_ineffect), alpha = 0.3) +\n        scale_color_manual(values = c(clrs[1], clrs[8])) +\n        scale_fill_manual(values = c(clrs[1], clrs[8])) +\n        scale_x_date(date_breaks = \"2 months\", date_labels = \"%b\\n%Y\") +\n        scale_y_continuous(labels = label_percent()) +\n        labs(x = NULL, y = \"Predicted probability\", \n             color = \"Derogation in effect\", fill = \"Derogation in effect\",\n             title = ..2) +\n        theme_pandem()\n    }\n  }))\n\nwrap_plots(h2_models_plots$pred_plot)\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n### Across civil society repression\n\n::: {.column-page-right}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nh2_models_plots1 <- m_h2 %>% \n  mutate(pred_plot = pmap(list(model, nice, family), ~{\n    if (..3 == \"cumulative\") {\n      datagrid(model = ..1,\n               v2csreprss = seq(-2.5, 3, by = 0.1),\n               derogation_ineffect = 0:1) %>% \n        add_epred_draws(..1) %>% \n        mutate(derogation_ineffect = factor(derogation_ineffect, \n                                            levels = 0:1,\n                                            labels = c(\"No derogation\", \"Derogation in effect\"),\n                                            ordered = TRUE)) %>% \n        ggplot(aes(x = v2csreprss, y = .epred, color = .category)) +\n        stat_lineribbon(aes(fill = .category), alpha = 0.3) +\n        scale_color_manual(values = c(clrs[c(2, 4, 6, 7)])) +\n        scale_fill_manual(values = c(clrs[c(2, 4, 6, 7)])) +\n        scale_y_continuous(labels = label_percent()) +\n        labs(x = \"Civil society repression\", y = \"Predicted probability\", \n             color = \"Severity\", fill = \"Severity\",\n             title = ..2) +\n        facet_wrap(vars(derogation_ineffect)) +\n        theme_pandem()\n    } else {\n      datagrid(model = ..1,\n               v2csreprss = seq(-2.5, 3, by = 0.1),\n               derogation_ineffect = 0:1) %>% \n        add_epred_draws(..1) %>% \n        mutate(derogation_ineffect = factor(derogation_ineffect, \n                                            levels = 0:1,\n                                            labels = c(\"No\", \"Yes\"),\n                                            ordered = TRUE)) %>% \n        ggplot(aes(x = v2csreprss, y = .epred, color = derogation_ineffect)) +\n        stat_lineribbon(aes(fill = derogation_ineffect), alpha = 0.3) +\n        scale_color_manual(values = c(clrs[1], clrs[8])) +\n        scale_fill_manual(values = c(clrs[1], clrs[8])) +\n        scale_y_continuous(labels = label_percent()) +\n        labs(x = \"Civil society repression\", y = \"Predicted probability\", \n             color = \"Derogation in effect\", fill = \"Derogation in effect\",\n             title = ..2) +\n        theme_pandem()\n    }\n  }))\n\nwrap_plots(h2_models_plots1$pred_plot)\n```\n\n::: {.cell-output-display}\n![](analysis_h2_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n## Marginal effects\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# TODO: Figure out how to work with ordered logit marginal effects\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}